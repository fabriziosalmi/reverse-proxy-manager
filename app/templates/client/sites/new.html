{% extends "base.html" %}

{% block title %}Add New Site - Italia CDN Proxy Manager{% endblock %}

{% block content %}
<div class="mb-6">
    <h1 class="text-3xl font-bold mb-2">Add New Site</h1>
    <p class="text-gray-600">Configure a new site to be proxied through the CDN.</p>
</div>

<div class="bg-white p-6 rounded-lg shadow-md">
    <form method="POST" action="{{ url_for('client.new_site') }}">
        <!-- Basic Information -->
        <div class="mb-6">
            <h2 class="text-xl font-semibold mb-4">Basic Information</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="name" class="block text-gray-700 font-medium mb-2">Site Name</label>
                    <input type="text" id="name" name="name" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="My Website">
                    <p class="text-sm text-gray-500 mt-1">A friendly name to identify this site</p>
                </div>
                
                <div>
                    <label for="domain" class="block text-gray-700 font-medium mb-2">Domain Name</label>
                    <input type="text" id="domain" name="domain" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="example.com">
                    <p class="text-sm text-gray-500 mt-1">The domain that will point to this proxy</p>
                </div>
            </div>
        </div>
        
        <!-- Origin Server Information -->
        <div class="mb-6">
            <h2 class="text-xl font-semibold mb-4">Origin Server</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label for="protocol" class="block text-gray-700 font-medium mb-2">Protocol</label>
                    <select id="protocol" name="protocol" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="http">HTTP</option>
                        <option value="https" selected>HTTPS</option>
                    </select>
                </div>
                
                <div>
                    <label for="origin_address" class="block text-gray-700 font-medium mb-2">Origin Address</label>
                    <input type="text" id="origin_address" name="origin_address" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="123.45.67.89 or origin-server.com">
                </div>
                
                <div>
                    <label for="origin_port" class="block text-gray-700 font-medium mb-2">Port</label>
                    <input type="number" id="origin_port" name="origin_port" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           value="443" min="1" max="65535">
                </div>
            </div>
        </div>
        
        <!-- Deployment Nodes -->
        <div class="mb-6">
            <h2 class="text-xl font-semibold mb-4">Deployment Nodes</h2>
            <p class="text-gray-600 mb-3">Select one or more nodes where this site will be deployed:</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {% for node in nodes %}
                <div class="border rounded-md p-3 {% if not node.is_active %}opacity-50{% endif %}">
                    <label class="flex items-start">
                        <input type="checkbox" name="nodes" value="{{ node.id }}" class="mt-1 mr-2"
                               {% if not node.is_active %}disabled{% endif %}>
                        <div>
                            <span class="font-medium">{{ node.name }}</span>
                            <span class="text-xs px-2 py-0.5 ml-2 rounded-full {% if node.is_active %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                                {{ 'Active' if node.is_active else 'Inactive' }}
                            </span>
                            <p class="text-sm text-gray-500">{{ node.ip_address }}</p>
                        </div>
                    </label>
                </div>
                {% endfor %}
            </div>
            
            {% if not nodes %}
            <p class="text-yellow-600">No active nodes are available. Please contact an administrator.</p>
            {% endif %}
        </div>
        
        <!-- Advanced Settings -->
        <div class="mb-6">
            <h2 class="text-xl font-semibold mb-4">Advanced Settings</h2>
            
            <div class="mb-4">
                <label class="flex items-center">
                    <input type="checkbox" name="use_waf" class="mr-2">
                    <div>
                        <span class="font-medium">Enable WAF</span>
                        <p class="text-sm text-gray-500">Use Web Application Firewall for additional security</p>
                    </div>
                </label>
            </div>
            
            <div>
                <label for="custom_config" class="block text-gray-700 font-medium mb-2">Custom Nginx Configuration</label>
                <textarea id="custom_config" name="custom_config" rows="6"
                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                          placeholder="# Add custom Nginx configuration directives here"></textarea>
                <p class="text-sm text-gray-500 mt-1">Advanced users can add custom Nginx configuration directives</p>
            </div>
        </div>
        
        <div class="flex justify-between">
            <a href="{{ url_for('client.list_sites') }}" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50">
                Cancel
            </a>
            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                Create Site
            </button>
        </div>
    </form>
</div>
{% endblock %}